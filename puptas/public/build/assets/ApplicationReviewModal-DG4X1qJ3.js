import{j as st,r as n,i as at,y as nt,p as rt,d as r,o as i,e as m,b as it,a as e,t as s,F as v,f as u,h as P,m as U,g as F,n as ut,l as B,w as dt,q as ct}from"./app-BMHqDqk-.js";import{_ as pt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const gt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40"},mt={class:"bg-white dark:bg-gray-900 rounded-xl shadow-2xl max-w-5xl w-full p-6 overflow-auto max-h-[90vh] relative",style:{"min-width":"700px"}},vt={key:0,class:"text-gray-700"},xt={key:1,class:"text-red-600 dark:text-red-400"},bt={class:"grid grid-cols-2 gap-8"},ft={class:"mb-6"},yt={class:"mb-6"},wt={class:"mt-4"},ht=["value"],kt={class:"mt-4"},Ct=["value","disabled"],It={class:"grid grid-cols-3 gap-3"},Mt={class:"text-sm font-medium text-gray-700 mb-1"},St=["src","onClick"],At={key:1,class:"placeholder"},_t=["onClick"],Ft={class:"flex justify-end space-x-4 mt-6"},Rt=["disabled"],Dt={key:0,class:"text-sm text-gray-600 mt-2"},Et={key:3,class:"text-gray-700"},Nt={class:"relative max-w-[90vw] max-h-[90vh]"},Pt=["src"],Ut={key:0,class:"fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white px-4 py-2 rounded shadow-lg z-50"},Bt={__name:"ApplicationReviewModal",props:{show:Boolean,userEmail:String},emits:["close","reupload"],setup(T,{emit:V}){const z=o=>o.replace(/([A-Z])/g," $1").replace(/^./,t=>t.toUpperCase()).replace(/_/g," "),k=window.axios,L=T,Y=V;st(()=>L.show,async o=>{o&&await I()});const p=n(""),x=n(""),b=n(!1),C=n(!1),f=n(""),a=n(null),g=n({visible:!1,message:""}),R=(o,t=3e3)=>{g.value.message=o,g.value.visible=!0,setTimeout(()=>{g.value.visible=!1},t)},y=at(()=>{var t;const o=(t=a.value)==null?void 0:t.status;return!o||["draft","returned"].includes(o)}),I=async()=>{var o;C.value=!0,f.value="";try{const t=await k.get("/user/application");a.value=t.data,console.log("Application status:",(o=a.value)==null?void 0:o.status),await ot(),console.log("Setting selected:",t.data.program_id),nt(()=>{p.value=t.data.program_id??"",x.value=t.data.second_choice_id??""})}catch{f.value="Failed to load application data."}finally{C.value=!1}},D=()=>{b.value=!0,I()},M=()=>{b.value=!1},G=async()=>{var o,t,d,l,c,h,N;try{await k.post("/user/application/submit",{program_id:p.value,second_choice_id:x.value||null}),await I(),Y("refreshDashboard"),R("Application submitted!"),setTimeout(()=>{M()},1e3)}catch(_){const lt=((t=(o=_.response)==null?void 0:o.data)==null?void 0:t.message)||((h=(c=(l=(d=_.response)==null?void 0:d.data)==null?void 0:l.errors)==null?void 0:c.program_id)==null?void 0:h[0])||"Failed to submit application. Choose programs before submitting.";R(lt),console.error("Submit error:",(N=_.response)==null?void 0:N.data)}};rt(()=>{D(),H.value={file10Front:null,file11:null,file12:null,schoolId:null,nonEnrollCert:null,psa:null,goodMoral:null,underOath:null,photo2x2:null}});const w=n(null),S=n(!1),$=o=>{const t=typeof o=="string"?o:o==null?void 0:o.url;if(console.log("openImageModal called with:",o),console.log("Extracted URL:",t),!t){console.warn("No valid URL found");return}w.value=t,S.value=!0},E=()=>{S.value=!1,w.value=null},H=n({}),q=n(null),Z=n(null),j=n(null),J=n(null),K=n(null),Q=n(null),W=n(null),X=n(null),O=n(null),tt=n(null),et=o=>{const d={file10Front:q,file:Z,file11:j,file12:J,schoolId:K,nonEnrollCert:Q,psa:W,goodMoral:X,underOath:O,photo2x2:tt}[o];d&&d.value&&d.value.click()},A=n([]),ot=async()=>{try{const o=await k.get("/user/eligible-programs");A.value=o.data.programs}catch{console.error("Failed to load eligible programs")}};return(o,t)=>{var d;return i(),r(v,null,[b.value?(i(),r("div",gt,[e("div",mt,[e("button",{onClick:M,class:"absolute top-3 right-3 text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white text-3xl font-bold","aria-label":"Close modal"}," × "),C.value?(i(),r("p",vt,"Loading application data...")):f.value?(i(),r("p",xt,s(f.value),1)):a.value?(i(),r(v,{key:2},[t[25]||(t[25]=e("h2",{class:"text-2xl font-bold mb-6 text-gray-900 dark:text-white"}," Review Your Application ",-1)),e("div",bt,[e("div",null,[e("section",ft,[t[10]||(t[10]=e("h3",{class:"font-semibold mb-2 text-gray-800 dark:text-gray-300"},"Personal Details",-1)),e("p",null,[t[4]||(t[4]=e("strong",null,"Name:",-1)),u(" "+s(a.value.firstname)+" "+s(a.value.middlename)+" "+s(a.value.lastname),1)]),e("p",null,[t[5]||(t[5]=e("strong",null,"Birthday:",-1)),u(" "+s(a.value.birthday),1)]),e("p",null,[t[6]||(t[6]=e("strong",null,"Sex/Gender:",-1)),u(" "+s(a.value.sex),1)]),e("p",null,[t[7]||(t[7]=e("strong",null,"Contact:",-1)),u(" +63"+s(a.value.contactnumber),1)]),e("p",null,[t[8]||(t[8]=e("strong",null,"Address:",-1)),u(" "+s(a.value.address),1)]),e("p",null,[t[9]||(t[9]=e("strong",null,"Email:",-1)),u(" "+s(a.value.email),1)])]),e("section",yt,[t[17]||(t[17]=e("h3",{class:"font-semibold mb-2 text-gray-800 dark:text-gray-300"},"High School Details",-1)),e("p",null,[t[11]||(t[11]=e("strong",null,"School:",-1)),u(" "+s(a.value.school),1)]),e("p",null,[t[12]||(t[12]=e("strong",null,"School Address:",-1)),u(" "+s(a.value.schoolAdd),1)]),e("p",null,[t[13]||(t[13]=e("strong",null,"School Year:",-1)),u(" "+s(a.value.schoolyear),1)]),e("p",null,[t[14]||(t[14]=e("strong",null,"Date Graduated:",-1)),u(" "+s(a.value.dateGrad),1)]),e("p",null,[t[15]||(t[15]=e("strong",null,"Strand:",-1)),u(" "+s(a.value.strand),1)]),e("p",null,[t[16]||(t[16]=e("strong",null,"Track:",-1)),u(" "+s(a.value.track),1)])]),e("div",wt,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700"},"Choose Your Program",-1)),P(e("select",{"onUpdate:modelValue":t[0]||(t[0]=l=>p.value=l),class:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:ring-maroon-500 focus:border-maroon-500"},[t[18]||(t[18]=e("option",{value:""},"-- Select Program --",-1)),(i(!0),r(v,null,F(A.value,l=>(i(),r("option",{key:l.id,value:l.id},s(l.name)+" ("+s(l.code)+") ",9,ht))),128))],512),[[U,p.value]])]),e("div",kt,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700"},"Choose Your Second Program",-1)),P(e("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>x.value=l),class:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:ring-maroon-500 focus:border-maroon-500"},[t[20]||(t[20]=e("option",{value:""},"-- Select Program --",-1)),(i(!0),r(v,null,F(A.value,l=>(i(),r("option",{key:l.id,value:l.id,disabled:l.id===p.value},s(l.name)+" ("+s(l.code)+") ",9,Ct))),128))],512),[[U,x.value]])])]),e("section",null,[t[22]||(t[22]=e("h3",{class:"font-semibold mb-2 text-gray-800 dark:text-gray-300"},"Uploaded Documents",-1)),e("div",It,[(i(!0),r(v,null,F(a.value.uploadedFiles,(l,c)=>(i(),r("div",{key:c,class:"image-wrapper"},[e("p",Mt,s(z(c)),1),l?(i(),r("img",{key:0,src:l==null?void 0:l.url,alt:"Uploaded Document",class:"max-h-20 object-cover rounded border border-gray-300 cursor-pointer hover:scale-105 transition-transform duration-200",onClick:h=>$(l)},null,8,St)):(i(),r("div",At," No Image Uploaded ")),e("button",{class:"mt-1 px-3 py-1 bg-gray-100 hover:bg-maroon-100 text-gray-800 rounded text-xs shadow-sm",onClick:h=>et(c)}," Reupload ",8,_t)]))),128))])])]),e("div",Ft,[e("button",{onClick:M,class:"px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300 text-gray-800"}," Cancel "),e("button",{disabled:!y.value,onClick:G,class:ut(["px-4 py-2 rounded-lg text-white",{"bg-gray-400 cursor-not-allowed":!y.value,"bg-maroon-700 hover:bg-maroon-900":y.value}])}," Submit Application ",10,Rt),(d=a.value)!=null&&d.status&&!y.value?(i(),r("p",Dt,[t[23]||(t[23]=u(" Application already ")),e("strong",null,s(a.value.status),1),t[24]||(t[24]=u(". "))])):m("",!0)])],64)):(i(),r("p",Et,"No application data found."))])])):m("",!0),b.value?m("",!0):(i(),r("button",{key:1,onClick:D,"aria-label":"Open Application Modal",class:"fixed bottom-8 right-8 bg-maroon-700 hover:bg-maroon-900 text-white p-8 rounded-full shadow-lg focus:outline-none",title:"Review Application"},t[26]||(t[26]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]))),S.value?(i(),r("div",{key:2,class:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-[60]",onClick:E},[e("div",Nt,[e("img",{src:w.value,alt:"Preview",class:"max-w-full max-h-[90vh] object-contain rounded shadow-lg",onClick:t[2]||(t[2]=B(()=>{},["stop"])),onError:t[3]||(t[3]=l=>console.error("Image failed to load:",w.value))},null,40,Pt)]),e("button",{onClick:B(E,["stop"]),class:"absolute top-5 right-5 text-white text-4xl font-bold hover:text-gray-300","aria-label":"Close preview"}," × ")])):m("",!0),it(ct,{name:"fade"},{default:dt(()=>[g.value.visible?(i(),r("div",Ut,s(g.value.message),1)):m("",!0)]),_:1})],64)}}},zt=pt(Bt,[["__scopeId","data-v-7c16e45a"]]);export{zt as default};
