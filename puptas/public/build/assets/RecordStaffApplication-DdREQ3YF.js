import{r,Q as ce,p as H,i as S,j as pe,d as n,o as i,b as E,u as ve,Z as me,w as M,a as t,e as g,h as K,v as ge,t as l,F as A,g as $,n as Q,q as X,s as fe,f as xe,l as he}from"./app-B9ioD5Tj.js";import{C as be,L as we,a as ye,b as ke,c as Ce,P as _e,p as Se,d as Ee,e as Ae}from"./chart-B9tDx7Vv.js";import"./index-BP1wD6F3.js";import{_ as Fe}from"./RecordStaffLayout-CYjLSvUw.js";import{_ as Ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Sidebar-Dz9939gr.js";import"./useGlobalLoading-D_ggrvgV.js";const De={class:"max-w-7xl mx-auto py-2 px-2 sm:px-4 md:px-6 lg:px-8 overflow-x-hidden overflow-y-auto"},Me={class:"flex flex-col md:flex-row justify-between md:items-center mb-2 gap-2"},$e={class:"flex flex-wrap justify-end gap-2 items-center w-full md:w-auto"},je={class:"flex items-center border-4 border-red-400 rounded-full px-2 py-1.5 bg-white w-full sm:w-auto"},Le={class:"relative"},Pe={key:0,class:"absolute top-full mt-2 right-0 bg-white shadow-md border border-gray-200 rounded z-50 text-sm"},Ne={xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Ve=["d"],Re={class:"bg-white/20 rounded-xl shadow p-2 overflow-x-auto"},Be={class:"text-sm text-[#4B5563] mb-2"},Ie={class:"min-w-full text-base"},ze={class:"text-left text-white font-semibold"},Te={class:"divide-y divide-gray-600"},Ge=["onClick"],qe={class:"py-2 text-[#111827] font-medium"},Oe={class:"py-2 text-white"},He={class:"py-2"},Ke={class:"flex justify-end items-center space-x-4 mt-4"},Qe=["disabled"],Xe={class:"text-sm"},We=["disabled"],Ze={key:0,class:"text-center text-gray-400 mt-4"},Je={key:0,class:"fixed top-0 right-0 w-full md:w-1/3 h-full bg-white dark:bg-gray-900 p-6 z-50 shadow-xl shadow-red-200 transition duration-300 ease-in-out overflow-y-auto"},Ye={class:"text-gray-800 dark:text-gray-200 font-medium"},et={class:"text-gray-700 dark:text-gray-400"},tt={class:"mt-3 p-2 border rounded bg-gray-100 dark:bg-gray-800"},st={class:"text-sm text-gray-800 dark:text-gray-300"},ot={class:"mt-3 text-sm"},at={class:"grid grid-cols-3 gap-2"},lt={class:"flex items-center space-x-2 w-full"},rt=["id","onUpdate:modelValue"],nt=["for"],it={class:"w-full"},dt=["src","onClick"],ut={key:1,class:"h-16 flex items-center justify-center text-[10px] italic text-gray-400 border rounded"},ct={key:0,class:"mt-4"},pt={class:"border-l-2 border-red-400 pl-3 space-y-2"},vt={class:"text-sm font-semibold text-gray-900 dark:text-white"},mt={key:0,class:"text-xs text-gray-500 italic"},gt={class:"text-xs text-gray-400"},ft={key:0,class:"fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white px-4 py-2 rounded shadow-lg z-50"},xt=["src"],j=10,ht={__name:"RecordStaffApplication",setup(bt){be.register(we,ye,ke,Ce,_e,Se,Ee,Ae);const p=r(1),x=r("lastname"),v=r(""),c=r(!0),W=ce(),F=r(W.props.users||[]),d=r(null),Z=r(!0),J=r(""),h=r(""),y=r({});r("");const b=r({visible:!1,message:""}),k=(s,e=3e3)=>{b.value.message=s,b.value.visible=!0,setTimeout(()=>{b.value.visible=!1},e)},Y=s=>{const e=(s||"").toLowerCase();return e==="accepted"?"bg-green-100 text-green-700":e==="pending"?"bg-yellow-100 text-yellow-700":e==="rejected"?"bg-red-100 text-red-700":"bg-gray-100 text-gray-600"},C=async()=>{try{const s=await fetch("/medical-dashboard/applicants",{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!s.ok)throw new Error("Failed to fetch users");F.value=await s.json()}catch(s){J.value=s.message}finally{Z.value=!1}};H(()=>{C(),R()});const _=S(()=>{const s=h.value.trim().toLowerCase();return F.value.filter(e=>{var w;const a=`${e.firstname} ${e.lastname}`.toLowerCase().includes(s),f=v.value?((w=e.status)==null?void 0:w.toLowerCase())===v.value:!0;return a&&f}).sort((e,o)=>{const a=(e[x.value]||"").toString().toLowerCase(),f=(o[x.value]||"").toString().toLowerCase();return c.value?a.localeCompare(f):f.localeCompare(a)})});S(()=>h.value.trim()?_.value:F.value.slice(0,4));const ee=async s=>{var e,o;try{const a=await axios.get(`/medical-dashboard/application/${s.id}`);d.value={...s,application:{...a.data.user.application,processes:((e=a.data.user.application)==null?void 0:e.processes)||[],program:((o=a.data.user.application)==null?void 0:o.program)||null},grades:a.data.user.grades||null},y.value=a.data.uploadedFiles||{},console.log("Full user data:",a.data.user),console.log("Grades check:",a.data.user.grades),await R(),console.log("User & files:",d.value,y.value)}catch(a){console.error("Failed to fetch user data:",a),y.value={},d.value=null}},te=()=>{d.value=null},se=s=>({file10Front:"Grade 10 Front",file11:"Grade 11 Report",file12:"Grade 12 Report",schoolId:"School ID",nonEnrollCert:"Certificate of Non-Enrollment",psa:"PSA Birth Certificate",goodMoral:"Good Moral Certificate",underOath:"Under Oath Document",photo2x2:"2x2 Photo"})[s]||s,L=r(null),U=r(!1),oe=s=>{L.value=s,U.value=!0},P=()=>{U.value=!1},ae=r(!1),N=r({});r("");const V=s=>typeof s=="string"?s.charAt(0).toUpperCase()+s.slice(1):"",le=s=>new Date(s).toLocaleString(),re=async()=>{var s,e;try{await axios.post(`/record-dashboard/tag/${d.value.id}`),k("Tagged as officially enrolled."),d.value=null,await C()}catch(o){console.error("Accept failed:",o);const a=((e=(s=o.response)==null?void 0:s.data)==null?void 0:e.message)||"Failed to accept application due to an unexpected error.";k(a)}},ne=async()=>{var s,e;try{await axios.post(`/record-dashboard/untag/${d.value.id}`),k("Reverted to temporary enrolled."),d.value=null,await C()}catch(o){console.error("Revert failed:",o);const a=((e=(s=o.response)==null?void 0:s.data)==null?void 0:e.message)||"Failed to revert application due to an unexpected error.";k(a)}},ie=r([]),R=async()=>{try{const s=await axios.get("/interviewer-dashboard/programs");ie.value=s.data.programs}catch(s){console.error("Failed to load programs",s)}};H(C);const B=S(()=>Math.ceil(_.value.length/j)),D=S(()=>{const s=(p.value-1)*j;return _.value.slice(s,s+j)});pe([h,v,x,c],()=>{p.value=1});const de=s=>{x.value===s?c.value=!c.value:(x.value=s,c.value=!0)},ue=()=>{h.value="",v.value="",x.value="lastname",c.value=!0,p.value=1,showStatusDropdown.value=!1};return(s,e)=>(i(),n(A,null,[E(ve(me),{title:"All Medical Applications"}),E(Fe,null,{default:M(()=>[t("div",De,[t("div",Me,[e[12]||(e[12]=t("h2",{class:"text-2xl font-bold text-[#9E122C]"}," All Applications ",-1)),t("div",$e,[t("div",je,[e[10]||(e[10]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-[#9E122C] mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),K(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>h.value=o),type:"text",placeholder:"Search by name...",class:"bg-transparent border-none outline-none focus:ring-0 focus:outline-none text-sm text-[#9E122C] placeholder-gray-500 w-full"},null,512),[[ge,h.value]])]),t("button",{onClick:ue,class:"text-sm text-[#9E122C] border border-[#9E122C] rounded px-3 py-1.5 hover:bg-[#FDE8EA] transition"}," Clear Filters "),t("div",Le,[t("button",{onClick:e[1]||(e[1]=o=>s.showStatusDropdown=!s.showStatusDropdown),class:"text-[#9E122C] p-2 border border-[#9E122C] rounded-full",title:"Filter"},e[11]||(e[11]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2a1 1 0 01-.293.707L15 12.414V19a1 1 0 01-1.447.894l-4-2A1 1 0 019 17v-4.586L3.293 6.707A1 1 0 013 6V4z"})],-1)])),s.showStatusDropdown?(i(),n("div",Pe,[t("button",{class:"block px-4 py-2 w-full text-left hover:bg-gray-100",onClick:e[2]||(e[2]=o=>{v.value="",s.showStatusDropdown=!1})}," All "),t("button",{class:"block px-4 py-2 w-full text-left hover:bg-gray-100",onClick:e[3]||(e[3]=o=>{v.value="accepted",s.showStatusDropdown=!1})}," Accepted "),t("button",{class:"block px-4 py-2 w-full text-left hover:bg-gray-100",onClick:e[4]||(e[4]=o=>{v.value="pending",s.showStatusDropdown=!1})}," Pending "),t("button",{class:"block px-4 py-2 w-full text-left hover:bg-gray-100",onClick:e[5]||(e[5]=o=>{v.value="rejected",s.showStatusDropdown=!1})}," Rejected ")])):g("",!0)]),t("button",{onClick:e[6]||(e[6]=o=>c.value=!c.value),class:"text-[#9E122C] p-2 border border-[#9E122C] rounded-full",title:"Sort"},[(i(),n("svg",Ne,[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:c.value?"M5 15l7-7 7 7":"M19 9l-7 7-7-7"},null,8,Ve)]))])])]),t("div",Re,[t("div",Be," Showing "+l(D.value.length)+" of "+l(_.value.length)+" users ",1),t("table",Ie,[t("thead",null,[t("tr",ze,[t("th",{class:"pb-2 cursor-pointer",onClick:e[7]||(e[7]=o=>de("lastname"))}," Name "),e[13]||(e[13]=t("th",{class:"pb-2"},"Course",-1)),e[14]||(e[14]=t("th",{class:"pb-2"},"Status",-1))])]),t("tbody",Te,[(i(!0),n(A,null,$(D.value,o=>(i(),n("tr",{key:o.id,onClick:a=>ee(o),class:"cursor-pointer hover:bg-white/10 backdrop-blur-sm transition"},[t("td",qe,l(o.firstname)+" "+l(o.lastname),1),t("td",Oe,l(o.program.name||"—"),1),t("td",He,[t("span",{class:Q([Y(o.status),"px-2 py-1 rounded text-sm font-semibold"])},l(o.status||"Unknown"),3)])],8,Ge))),128))])]),t("div",Ke,[t("button",{onClick:e[8]||(e[8]=o=>p.value--),disabled:p.value===1,class:"text-sm text-[#9E122C] disabled:text-gray-900"}," Previous ",8,Qe),t("span",Xe,"Page "+l(p.value)+" of "+l(B.value),1),t("button",{onClick:e[9]||(e[9]=o=>p.value++),disabled:p.value===B.value,class:"text-sm text-[#9E122C] disabled:text-gray-900"}," Next ",8,We)]),D.value.length===0?(i(),n("p",Ze," No results found. ")):g("",!0)])]),E(X,{name:"slide-fade"},{default:M(()=>{var o,a,f,w,I,z,T,G,q;return[d.value?(i(),n("div",Je,[t("button",{class:"mt-6 px-4 py-2 rounded bg-[#9E122C] text-white hover:bg-[#EE6A43] transition",onClick:te}," Close "),e[19]||(e[19]=t("h3",{class:"text-xl font-semibold text-gray-900 dark:text-white mb-2"}," User Information ",-1)),t("p",Ye," Name: "+l(d.value.lastname)+", "+l(d.value.firstname),1),t("p",et," Email: "+l(d.value.email),1),t("div",tt,[e[15]||(e[15]=t("h4",{class:"text-sm font-bold text-gray-700 dark:text-white mb-1"}," Temporary enrolled in: ",-1)),t("p",st,l((f=(a=(o=d.value)==null?void 0:o.application)==null?void 0:a.program)==null?void 0:f.code)+" - "+l((z=(I=(w=d.value)==null?void 0:w.application)==null?void 0:I.program)==null?void 0:z.name),1)]),t("div",{class:"mt-4"},[t("div",{class:"mt-4 flex justify-end space-x-2"},[t("button",{onClick:re,class:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700"}," Tag: Officially Enrolled "),t("button",{onClick:ne,class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"}," Untag ")])]),t("section",ot,[e[18]||(e[18]=t("h4",{class:"font-semibold mb-1 text-base"}," Uploaded Documents ",-1)),t("div",at,[(i(!0),n(A,null,$(y.value,(u,m)=>(i(),n("div",{key:m,class:"flex flex-col items-start space-y-1"},[t("div",lt,[ae.value?K((i(),n("input",{key:0,type:"checkbox",id:m,"onUpdate:modelValue":O=>N.value[m]=O,class:"h-4 w-4 mt-1"},null,8,rt)),[[fe,N.value[m]]]):g("",!0),t("label",{for:m,class:"text-xs font-medium truncate w-full"},l(se(m)),9,nt)]),t("div",it,[u?(i(),n("img",{key:0,src:u,alt:"Uploaded Document",class:"h-16 w-full object-contain border rounded cursor-pointer",onClick:O=>oe(u)},null,8,dt)):(i(),n("div",ut," No Image "))])]))),128))]),(q=(G=(T=d.value)==null?void 0:T.application)==null?void 0:G.processes)!=null&&q.length?(i(),n("section",ct,[e[17]||(e[17]=t("h4",{class:"font-semibold mb-2 text-base text-gray-800 dark:text-gray-200"}," Application History ",-1)),t("ul",pt,[(i(!0),n(A,null,$(d.value.application.processes,(u,m)=>(i(),n("li",{key:m,class:"relative"},[e[16]||(e[16]=t("div",{class:"absolute -left-[10px] top-1 w-3 h-3 bg-red-600 rounded-full border-2 border-white"},null,-1)),t("p",vt,[xe(l(V(u.stage))+" - ",1),t("span",{class:Q({"text-green-600":u.status==="completed","text-yellow-600":u.status==="in_progress","text-red-600":u.status==="returned"})},l(V(u.status)),3)]),u.notes?(i(),n("p",mt," Note: "+l(u.notes),1)):g("",!0),t("p",gt,l(le(u.created_at)),1)]))),128))])])):g("",!0)])])):g("",!0)]}),_:1}),E(X,{name:"fade"},{default:M(()=>[b.value.visible?(i(),n("div",ft,l(b.value.message),1)):g("",!0)]),_:1}),U.value?(i(),n("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50",onClick:he(P,["self"])},[t("img",{src:L.value,alt:"Preview",class:"max-w-full max-h-full rounded shadow-lg"},null,8,xt),t("button",{onClick:P,class:"absolute top-5 right-5 text-white text-4xl font-bold hover:text-gray-300","aria-label":"Close preview"}," × ")])):g("",!0)]),_:1})],64))}},At=Ue(ht,[["__scopeId","data-v-7834febc"]]);export{At as default};
