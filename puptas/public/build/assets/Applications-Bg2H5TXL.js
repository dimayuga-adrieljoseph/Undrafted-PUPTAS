import{r as u,p as oe,i as U,j as le,d as a,o as r,b as S,u as ae,Z as re,w as H,a as t,e as p,h as J,v as ne,t as l,F as _,g as $,n as Q,q as ie,s as de,f as ue,l as ce}from"./app-BMHqDqk-.js";import{_ as pe}from"./AppLayout-pF509T1r.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Sidebar-DKWTbHSH.js";import"./index-CzAWaHTX.js";import"./useGlobalLoading-DQXpkgxt.js";const me={class:"max-w-7xl mx-auto p-6 px-2 sm:px-4 md:px-6 lg:px-8 overflow-x-hidden overflow-y-auto"},ge={class:"flex flex-col md:flex-row justify-between md:items-center mb-2 gap-2"},xe={class:"flex flex-wrap justify-end gap-2 items-center w-full md:w-auto"},fe={class:"flex items-center border-4 border-red-400 rounded-full px-2 py-1.5 bg-white w-full sm:w-auto"},be={class:"relative"},he={key:0,class:"absolute top-full mt-2 right-0 bg-white shadow-md border border-gray-200 rounded z-50 text-sm"},we={xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ye=["d"],ke={class:"bg-white/20 rounded-xl shadow p-2 overflow-x-auto"},Ce={key:0,class:"text-center text-gray-500 py-4"},_e={key:1,class:"text-center text-red-500 py-4"},Ee={key:2,class:"text-sm text-[#4B5563] mb-2"},Ae={class:"min-w-full text-base"},Me={class:"text-left text-white font-semibold"},Ue={class:"divide-y divide-gray-600"},Se=["onClick"],$e={class:"py-2 text-[#111827] font-medium"},Fe={class:"py-2 text-[#111827]"},Ne={class:"py-2"},je={class:"flex justify-end items-center space-x-4 mt-4"},Ie=["disabled"],Pe={class:"text-sm"},Le=["disabled"],Ve={key:3,class:"text-center text-gray-400 mt-4"},De={key:0,class:"fixed top-0 right-0 w-full md:w-1/3 h-full bg-white dark:bg-gray-900 p-6 z-50 shadow-xl shadow-red-200 transition duration-300 ease-in-out overflow-y-auto"},Be={class:"text-gray-800 dark:text-gray-200 font-medium"},ze={class:"text-gray-700 dark:text-gray-400"},Ge={class:"text-sm text-gray-700 dark:text-gray-300"},Re={class:"text-sm text-gray-700 dark:text-gray-300"},Te={class:"text-sm text-gray-700 dark:text-gray-300"},Oe={class:"mt-3 p-2 border rounded bg-gray-100 dark:bg-gray-800"},qe={class:"text-sm text-gray-800 dark:text-gray-300"},Ke={class:"mt-3 text-sm"},He={class:"grid grid-cols-3 gap-2"},Je={class:"flex items-center space-x-2 w-full"},Qe=["id","onUpdate:modelValue"],Ze=["for"],We={class:"w-full"},Xe=["src","onClick"],Ye={key:1,class:"h-16 flex items-center justify-center text-[10px] italic text-gray-400 border rounded"},et={key:0,class:"mt-4"},tt={class:"border-l-2 border-red-400 pl-3 space-y-2"},st={class:"text-sm font-semibold text-gray-900 dark:text-white"},ot={key:0,class:"text-xs text-gray-500 italic"},lt={class:"text-xs text-gray-400"},at=["src"],F=10,rt={__name:"Applications",setup(nt){const N=window.axios,E=u([]),k=u(!1),b=u(null),w=u(""),v=u(""),n=u(null),m=u(1),h=u("lastname"),c=u(!0),g=u(!1),C=u({});oe(async()=>{var s;k.value=!0,b.value=null;try{const e=await N.get("/dashboard/users");Array.isArray(e.data)?E.value=e.data:(b.value=typeof e.data=="string"?e.data:JSON.stringify(e.data),E.value=[])}catch(e){console.error("Failed to fetch users:",e),b.value=((s=e.response)==null?void 0:s.data)||e.message||String(e)}finally{k.value=!1}});const A=U(()=>{const s=w.value.trim().toLowerCase();return E.value.filter(e=>{var y;const i=`${e.firstname} ${e.lastname}`.toLowerCase().includes(s),f=v.value?((y=e.status)==null?void 0:y.toLowerCase())===v.value:!0;return i&&f}).sort((e,o)=>{const i=(e[h.value]||"").toString().toLowerCase(),f=(o[h.value]||"").toString().toLowerCase();return c.value?i.localeCompare(f):f.localeCompare(i)})}),j=U(()=>Math.ceil(A.value.length/F)),M=U(()=>{const s=(m.value-1)*F;return A.value.slice(s,s+F)});le([w,v,h,c],()=>{m.value=1});const Z=s=>{const e=(s||"").toLowerCase();return e==="accepted"?"bg-green-100 text-green-700":e==="pending"?"bg-yellow-100 text-yellow-700":e==="rejected"?"bg-red-100 text-red-700":"bg-gray-100 text-gray-600"},W=async s=>{var e,o;try{const i=await N.get(`/admin-dashboard/user-files/${s.id}`);n.value={...s,application:{...i.data.user.application,processes:((e=i.data.user.application)==null?void 0:e.processes)||[]},grades:i.data.user.grades||null},C.value=i.data.uploadedFiles||{},console.log("User & files:",n.value,C.value),console.log("processes:",n.processes),console.log("Processes:",(o=n.value.application)==null?void 0:o.processes)}catch(i){console.error("Failed to fetch user data:",i),C.value={},n.value=null}},X=s=>({file10Front:"Grade 10 Front",file11:"Grade 11 Report",file12:"Grade 12 Report",schoolId:"School ID",nonEnrollCert:"Certificate of Non-Enrollment",psa:"PSA Birth Certificate",goodMoral:"Good Moral Certificate",underOath:"Under Oath Document",photo2x2:"2x2 Photo"})[s]||s,I=s=>typeof s=="string"?s.charAt(0).toUpperCase()+s.slice(1):"",Y=s=>new Date(s).toLocaleString(),ee=()=>{n.value=null},te=s=>{h.value===s?c.value=!c.value:(h.value=s,c.value=!0)},se=()=>{w.value="",v.value="",h.value="lastname",c.value=!0,m.value=1,g.value=!1};return(s,e)=>(r(),a(_,null,[S(ae(re),{title:"All Applications"}),S(pe,null,{default:H(()=>[t("div",me,[t("div",ge,[e[14]||(e[14]=t("h2",{class:"text-2xl font-bold text-[#9E122C]"}," All Applications ",-1)),t("div",xe,[t("div",fe,[e[12]||(e[12]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-[#9E122C] mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),J(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>w.value=o),type:"text",placeholder:"Search by name...",class:"bg-transparent border-none outline-none focus:ring-0 focus:outline-none text-sm text-[#9E122C] placeholder-gray-500 w-full"},null,512),[[ne,w.value]])]),t("button",{onClick:se,class:"text-sm text-[#9E122C] border border-[#9E122C] rounded px-3 py-1.5 hover:bg-[#FDE8EA] transition"}," Clear Filters "),t("div",be,[t("button",{onClick:e[1]||(e[1]=o=>g.value=!g.value),class:"text-[#9E122C] p-2 border border-[#9E122C] rounded-full",title:"Filter"},e[13]||(e[13]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2a1 1 0 01-.293.707L15 12.414V19a1 1 0 01-1.447.894l-4-2A1 1 0 019 17v-4.586L3.293 6.707A1 1 0 013 6V4z"})],-1)])),g.value?(r(),a("div",he,[t("button",{class:"block px-4 py-2 w-full text-left hover:bg-gray-100",onClick:e[2]||(e[2]=o=>{v.value="",g.value=!1})}," All "),t("button",{class:"block px-4 py-2 w-full text-left hover:bg-gray-100",onClick:e[3]||(e[3]=o=>{v.value="accepted",g.value=!1})}," Accepted "),t("button",{class:"block px-4 py-2 w-full text-left hover:bg-gray-100",onClick:e[4]||(e[4]=o=>{v.value="pending",g.value=!1})}," Pending "),t("button",{class:"block px-4 py-2 w-full text-left hover:bg-gray-100",onClick:e[5]||(e[5]=o=>{v.value="rejected",g.value=!1})}," Rejected ")])):p("",!0)]),t("button",{onClick:e[6]||(e[6]=o=>c.value=!c.value),class:"text-[#9E122C] p-2 border border-[#9E122C] rounded-full",title:"Sort"},[(r(),a("svg",we,[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:c.value?"M5 15l7-7 7 7":"M19 9l-7 7-7-7"},null,8,ye)]))])])]),t("div",ke,[k.value?(r(),a("div",Ce,"Loading applicants…")):b.value?(r(),a("div",_e,"Error: "+l(b.value),1)):p("",!0),!k.value&&!b.value?(r(),a("div",Ee," Showing "+l(M.value.length)+" of "+l(A.value.length)+" users ",1)):p("",!0),t("table",Ae,[t("thead",null,[t("tr",Me,[t("th",{class:"pb-2 cursor-pointer",onClick:e[7]||(e[7]=o=>te("lastname"))}," Name "),e[15]||(e[15]=t("th",{class:"pb-2"},"Course",-1)),e[16]||(e[16]=t("th",{class:"pb-2"},"Status",-1))])]),t("tbody",Ue,[(r(!0),a(_,null,$(M.value,o=>(r(),a("tr",{key:o.id,onClick:i=>W(o),class:"cursor-pointer hover:bg-white/10 backdrop-blur-sm transition"},[t("td",$e,l(o.firstname)+" "+l(o.lastname),1),t("td",Fe,l(o.program.name||"—"),1),t("td",Ne,[t("span",{class:Q([Z(o.status),"px-2 py-1 rounded text-sm font-semibold"])},l(o.status||"Unknown"),3)])],8,Se))),128))])]),t("div",je,[t("button",{onClick:e[8]||(e[8]=o=>m.value--),disabled:m.value===1,class:"text-sm text-[#9E122C] disabled:text-gray-900"}," Previous ",8,Ie),t("span",Pe,"Page "+l(m.value)+" of "+l(j.value),1),t("button",{onClick:e[9]||(e[9]=o=>m.value++),disabled:m.value===j.value,class:"text-sm text-[#9E122C] disabled:text-gray-900"}," Next ",8,Le)]),M.value.length===0?(r(),a("p",Ve," No results found. ")):p("",!0)])]),S(ie,{name:"slide-fade"},{default:H(()=>{var o,i,f,y,P,L,V,D,B,z,G,R,T,O,q;return[n.value?(r(),a("div",De,[t("button",{class:"mt-6 px-4 py-2 rounded bg-[#9E122C] text-white hover:bg-[#EE6A43] transition",onClick:ee}," Close "),e[21]||(e[21]=t("h3",{class:"text-xl font-semibold text-gray-900 dark:text-white mb-2"}," User Information ",-1)),t("p",Be," Name: "+l(n.value.lastname)+", "+l(n.value.firstname),1),t("p",ze," Email: "+l(n.value.email),1),e[22]||(e[22]=t("h4",{class:"text-sm font-bold text-gray-700 dark:text-white mb-1"}," Grades ",-1)),t("p",Ge," Math: "+l(((i=(o=n.value)==null?void 0:o.grades)==null?void 0:i.mathematics)??"—"),1),t("p",Re," Science: "+l(((y=(f=n.value)==null?void 0:f.grades)==null?void 0:y.science)??"—"),1),t("p",Te," English: "+l(((L=(P=n.value)==null?void 0:P.grades)==null?void 0:L.english)??"—"),1),t("div",Oe,[e[17]||(e[17]=t("h4",{class:"text-sm font-bold text-gray-700 dark:text-white mb-1"}," Current Program for Acceptance: ",-1)),t("p",qe,l((B=(D=(V=n.value)==null?void 0:V.application)==null?void 0:D.program)==null?void 0:B.code)+" - "+l((R=(G=(z=n.value)==null?void 0:z.application)==null?void 0:G.program)==null?void 0:R.name),1)]),t("section",Ke,[e[20]||(e[20]=t("h4",{class:"font-semibold mb-1 text-base"}," Uploaded Documents ",-1)),t("div",He,[(r(!0),a(_,null,$(C.value,(d,x)=>(r(),a("div",{key:x,class:"flex flex-col items-start space-y-1"},[t("div",Je,[s.isEvaluating?J((r(),a("input",{key:0,type:"checkbox",id:x,"onUpdate:modelValue":K=>s.filesToReturn[x]=K,class:"h-4 w-4 mt-1"},null,8,Qe)),[[de,s.filesToReturn[x]]]):p("",!0),t("label",{for:x,class:"text-xs font-medium truncate w-full"},l(X(x)),9,Ze)]),t("div",We,[d?(r(),a("img",{key:0,src:d,alt:"Uploaded Document",class:"h-16 w-full object-contain border rounded cursor-pointer",onClick:K=>s.openImageModal(d)},null,8,Xe)):(r(),a("div",Ye," No Image "))])]))),128))]),(q=(O=(T=n.value)==null?void 0:T.application)==null?void 0:O.processes)!=null&&q.length?(r(),a("section",et,[e[19]||(e[19]=t("h4",{class:"font-semibold mb-2 text-base text-gray-800 dark:text-gray-200"}," Application History ",-1)),t("ul",tt,[(r(!0),a(_,null,$(n.value.application.processes,(d,x)=>(r(),a("li",{key:x,class:"relative"},[e[18]||(e[18]=t("div",{class:"absolute -left-[10px] top-1 w-3 h-3 bg-red-600 rounded-full border-2 border-white"},null,-1)),t("p",st,[ue(l(I(d.stage))+" - ",1),t("span",{class:Q({"text-green-600":d.status==="completed","text-yellow-600":d.status==="in_progress","text-red-600":d.status==="returned"})},l(I(d.status)),3)]),d.notes?(r(),a("p",ot," Note: "+l(d.notes),1)):p("",!0),t("p",lt,l(Y(d.created_at)),1)]))),128))])])):p("",!0)])])):p("",!0)]}),_:1}),s.showImageModal?(r(),a("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50",onClick:e[11]||(e[11]=ce((...o)=>s.closeImageModal&&s.closeImageModal(...o),["self"]))},[t("img",{src:s.previewImage,alt:"Preview",class:"max-w-full max-h-full rounded shadow-lg"},null,8,at),t("button",{onClick:e[10]||(e[10]=(...o)=>s.closeImageModal&&s.closeImageModal(...o)),class:"absolute top-5 right-5 text-white text-4xl font-bold hover:text-gray-300","aria-label":"Close preview"}," × ")])):p("",!0)]),_:1})],64))}},gt=ve(rt,[["__scopeId","data-v-c89398db"]]);export{gt as default};
