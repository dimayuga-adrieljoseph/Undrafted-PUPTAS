import{j as ot,r as n,i as et,y as lt,p as st,d as r,o as i,e as g,b as at,a as o,t as l,F as m,f as u,h as D,m as E,g as A,n as nt,l as N,w as rt,q as it}from"./app-DfB9M8U9.js";import{_ as ut}from"./_plugin-vue_export-helper-DlAUqK2U.js";const dt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40"},ct={class:"bg-white dark:bg-gray-900 rounded-xl shadow-2xl max-w-5xl w-full p-6 overflow-auto max-h-[90vh] relative",style:{"min-width":"700px"}},pt={key:0,class:"text-gray-700"},gt={key:1,class:"text-red-600 dark:text-red-400"},mt={class:"grid grid-cols-2 gap-8"},vt={class:"mb-6"},xt={class:"mb-6"},bt={class:"mt-4"},ft=["value"],yt={class:"mt-4"},wt=["value","disabled"],ht={class:"grid grid-cols-3 gap-3"},kt={class:"text-sm font-medium text-gray-700 mb-1"},Ct=["src","onClick"],It={key:1,class:"placeholder"},Mt=["onClick"],St={class:"flex justify-end space-x-4 mt-6"},At=["disabled"],_t={key:0,class:"text-sm text-gray-600 mt-2"},Ft={key:3,class:"text-gray-700"},Rt={class:"relative max-w-[90vw] max-h-[90vh]"},Dt=["src"],Et={key:0,class:"fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white px-4 py-2 rounded shadow-lg z-50"},Nt={__name:"ApplicationReviewModal",props:{show:Boolean,userEmail:String},emits:["close","reupload"],setup(P,{emit:U}){const B=e=>e.replace(/([A-Z])/g," $1").replace(/^./,t=>t.toUpperCase()).replace(/_/g," "),w=window.axios,T=P,V=U;ot(()=>T.show,async e=>{e&&await k()});const c=n(""),v=n(""),x=n(!1),h=n(!1),b=n(""),s=n(null),p=n({visible:!1,message:""}),_=(e,t=3e3)=>{p.value.message=e,p.value.visible=!0,setTimeout(()=>{p.value.visible=!1},t)},f=et(()=>{var t;const e=(t=s.value)==null?void 0:t.status;return!e||["draft","returned"].includes(e)}),k=async()=>{var e;h.value=!0,b.value="";try{const t=await w.get("/user/application");s.value=t.data,console.log("Application status:",(e=s.value)==null?void 0:e.status),await O(),console.log("Setting selected:",t.data.program_id),lt(()=>{c.value=t.data.program_id??"",v.value=t.data.second_choice_id??""})}catch{b.value="Failed to load application data."}finally{h.value=!1}},F=()=>{x.value=!0,k()},C=()=>{x.value=!1},z=async()=>{try{await w.post("/user/application/submit",{program_id:c.value,second_choice_id:v.value||null}),await k(),V("refreshDashboard"),_("Application submitted!"),setTimeout(()=>{C()},1e3)}catch{_("Failed to submit application. Choose programs before submitting.")}};st(()=>{F(),Y.value={file10Front:null,file11:null,file12:null,schoolId:null,nonEnrollCert:null,psa:null,goodMoral:null,underOath:null,photo2x2:null}});const y=n(null),I=n(!1),L=e=>{const t=typeof e=="string"?e:e==null?void 0:e.url;if(console.log("openImageModal called with:",e),console.log("Extracted URL:",t),!t){console.warn("No valid URL found");return}y.value=t,I.value=!0},R=()=>{I.value=!1,y.value=null},Y=n({}),G=n(null),$=n(null),H=n(null),q=n(null),Z=n(null),j=n(null),J=n(null),K=n(null),Q=n(null),W=n(null),X=e=>{const d={file10Front:G,file:$,file11:H,file12:q,schoolId:Z,nonEnrollCert:j,psa:J,goodMoral:K,underOath:Q,photo2x2:W}[e];d&&d.value&&d.value.click()},M=n([]),O=async()=>{try{const e=await w.get("/user/eligible-programs");M.value=e.data.programs}catch{console.error("Failed to load eligible programs")}};return(e,t)=>{var d;return i(),r(m,null,[x.value?(i(),r("div",dt,[o("div",ct,[o("button",{onClick:C,class:"absolute top-3 right-3 text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white text-3xl font-bold","aria-label":"Close modal"}," × "),h.value?(i(),r("p",pt,"Loading application data...")):b.value?(i(),r("p",gt,l(b.value),1)):s.value?(i(),r(m,{key:2},[t[25]||(t[25]=o("h2",{class:"text-2xl font-bold mb-6 text-gray-900 dark:text-white"}," Review Your Application ",-1)),o("div",mt,[o("div",null,[o("section",vt,[t[10]||(t[10]=o("h3",{class:"font-semibold mb-2 text-gray-800 dark:text-gray-300"},"Personal Details",-1)),o("p",null,[t[4]||(t[4]=o("strong",null,"Name:",-1)),u(" "+l(s.value.firstname)+" "+l(s.value.middlename)+" "+l(s.value.lastname),1)]),o("p",null,[t[5]||(t[5]=o("strong",null,"Birthday:",-1)),u(" "+l(s.value.birthday),1)]),o("p",null,[t[6]||(t[6]=o("strong",null,"Sex/Gender:",-1)),u(" "+l(s.value.sex),1)]),o("p",null,[t[7]||(t[7]=o("strong",null,"Contact:",-1)),u(" +63"+l(s.value.contactnumber),1)]),o("p",null,[t[8]||(t[8]=o("strong",null,"Address:",-1)),u(" "+l(s.value.address),1)]),o("p",null,[t[9]||(t[9]=o("strong",null,"Email:",-1)),u(" "+l(s.value.email),1)])]),o("section",xt,[t[17]||(t[17]=o("h3",{class:"font-semibold mb-2 text-gray-800 dark:text-gray-300"},"High School Details",-1)),o("p",null,[t[11]||(t[11]=o("strong",null,"School:",-1)),u(" "+l(s.value.school),1)]),o("p",null,[t[12]||(t[12]=o("strong",null,"School Address:",-1)),u(" "+l(s.value.schoolAdd),1)]),o("p",null,[t[13]||(t[13]=o("strong",null,"School Year:",-1)),u(" "+l(s.value.schoolyear),1)]),o("p",null,[t[14]||(t[14]=o("strong",null,"Date Graduated:",-1)),u(" "+l(s.value.dateGrad),1)]),o("p",null,[t[15]||(t[15]=o("strong",null,"Strand:",-1)),u(" "+l(s.value.strand),1)]),o("p",null,[t[16]||(t[16]=o("strong",null,"Track:",-1)),u(" "+l(s.value.track),1)])]),o("div",bt,[t[19]||(t[19]=o("label",{class:"block text-sm font-medium text-gray-700"},"Choose Your Program",-1)),D(o("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>c.value=a),class:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:ring-maroon-500 focus:border-maroon-500"},[t[18]||(t[18]=o("option",{value:""},"-- Select Program --",-1)),(i(!0),r(m,null,A(M.value,a=>(i(),r("option",{key:a.id,value:a.id},l(a.name)+" ("+l(a.code)+") ",9,ft))),128))],512),[[E,c.value]])]),o("div",yt,[t[21]||(t[21]=o("label",{class:"block text-sm font-medium text-gray-700"},"Choose Your Second Program",-1)),D(o("select",{"onUpdate:modelValue":t[1]||(t[1]=a=>v.value=a),class:"mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:ring-maroon-500 focus:border-maroon-500"},[t[20]||(t[20]=o("option",{value:""},"-- Select Program --",-1)),(i(!0),r(m,null,A(M.value,a=>(i(),r("option",{key:a.id,value:a.id,disabled:a.id===c.value},l(a.name)+" ("+l(a.code)+") ",9,wt))),128))],512),[[E,v.value]])])]),o("section",null,[t[22]||(t[22]=o("h3",{class:"font-semibold mb-2 text-gray-800 dark:text-gray-300"},"Uploaded Documents",-1)),o("div",ht,[(i(!0),r(m,null,A(s.value.uploadedFiles,(a,S)=>(i(),r("div",{key:S,class:"image-wrapper"},[o("p",kt,l(B(S)),1),a?(i(),r("img",{key:0,src:a==null?void 0:a.url,alt:"Uploaded Document",class:"max-h-20 object-cover rounded border border-gray-300 cursor-pointer hover:scale-105 transition-transform duration-200",onClick:tt=>L(a)},null,8,Ct)):(i(),r("div",It," No Image Uploaded ")),o("button",{class:"mt-1 px-3 py-1 bg-gray-100 hover:bg-maroon-100 text-gray-800 rounded text-xs shadow-sm",onClick:tt=>X(S)}," Reupload ",8,Mt)]))),128))])])]),o("div",St,[o("button",{onClick:C,class:"px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300 text-gray-800"}," Cancel "),o("button",{disabled:!f.value,onClick:z,class:nt(["px-4 py-2 rounded-lg text-white",{"bg-gray-400 cursor-not-allowed":!f.value,"bg-maroon-700 hover:bg-maroon-900":f.value}])}," Submit Application ",10,At),(d=s.value)!=null&&d.status&&!f.value?(i(),r("p",_t,[t[23]||(t[23]=u(" Application already ")),o("strong",null,l(s.value.status),1),t[24]||(t[24]=u(". "))])):g("",!0)])],64)):(i(),r("p",Ft,"No application data found."))])])):g("",!0),x.value?g("",!0):(i(),r("button",{key:1,onClick:F,"aria-label":"Open Application Modal",class:"fixed bottom-8 right-8 bg-maroon-700 hover:bg-maroon-900 text-white p-8 rounded-full shadow-lg focus:outline-none",title:"Review Application"},t[26]||(t[26]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]))),I.value?(i(),r("div",{key:2,class:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-[60]",onClick:R},[o("div",Rt,[o("img",{src:y.value,alt:"Preview",class:"max-w-full max-h-[90vh] object-contain rounded shadow-lg",onClick:t[2]||(t[2]=N(()=>{},["stop"])),onError:t[3]||(t[3]=a=>console.error("Image failed to load:",y.value))},null,40,Dt)]),o("button",{onClick:N(R,["stop"]),class:"absolute top-5 right-5 text-white text-4xl font-bold hover:text-gray-300","aria-label":"Close preview"}," × ")])):g("",!0),at(it,{name:"fade"},{default:rt(()=>[p.value.visible?(i(),r("div",Et,l(p.value.message),1)):g("",!0)]),_:1})],64)}}},Bt=ut(Nt,[["__scopeId","data-v-f781615c"]]);export{Bt as default};
