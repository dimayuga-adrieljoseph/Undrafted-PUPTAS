import{r as i,Q as xe,p as Z,i as F,j as be,d as o,o as l,b as _,u as N,Z as he,w as $,a as t,e as c,h as L,v as J,t as r,F as M,g as P,n as Y,q as ee,f as te,s as we,l as ye}from"./app-B9ioD5Tj.js";import{_ as ke}from"./MedicalLayout-BLq9q89K.js";import{C as Ce,L as _e,a as Ee,b as Se,c as Ae,P as Fe,p as Me,d as je,e as Ue}from"./chart-B9tDx7Vv.js";import{F as De,c as Ne}from"./index-BP1wD6F3.js";import{_ as $e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Sidebar-Dz9939gr.js";import"./useGlobalLoading-D_ggrvgV.js";const Le={class:"max-w-7xl mx-auto py-2 px-2 sm:px-4 md:px-6 lg:px-8 overflow-x-hidden overflow-y-auto"},Pe={class:"flex flex-col md:flex-row justify-between md:items-center mb-2 gap-2"},Re={class:"flex flex-wrap justify-end gap-2 items-center w-full md:w-auto"},Ve={class:"flex items-center border-4 border-red-400 rounded-full px-2 py-1.5 bg-white w-full sm:w-auto"},Be={class:"relative"},Ie={key:0,class:"absolute top-full mt-2 right-0 bg-white shadow-md border border-gray-200 rounded z-50 text-sm"},ze={xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Ge=["d"],Te={class:"bg-white/20 rounded-xl shadow p-2 overflow-x-auto"},qe={class:"text-sm text-[#4B5563] mb-2"},Oe={class:"min-w-full text-base"},He={class:"text-left text-white font-semibold"},Ke={class:"divide-y divide-gray-600"},Qe=["onClick"],Xe={class:"py-2 text-[#111827] font-medium"},We={class:"py-2 text-white"},Ze={class:"py-2"},Je={class:"flex justify-end items-center space-x-4 mt-4"},Ye=["disabled"],et={class:"text-sm"},tt=["disabled"],st={key:0,class:"text-center text-gray-400 mt-4"},at={key:0,class:"fixed top-0 right-0 w-full md:w-1/3 h-full bg-white dark:bg-gray-900 p-6 z-50 shadow-xl shadow-red-200 transition duration-300 ease-in-out overflow-y-auto"},ot={class:"text-gray-800 dark:text-gray-200 font-medium"},lt={class:"text-gray-700 dark:text-gray-400"},rt={class:"mt-3 p-2 border rounded bg-gray-100 dark:bg-gray-800"},nt={class:"text-sm text-gray-800 dark:text-gray-300"},it={class:"mt-3 flex space-x-2 justify-end"},dt={key:0,class:"mt-2"},ut={key:1,class:"mt-2 flex justify-end"},ct={class:"mt-3 text-sm"},pt={class:"grid grid-cols-3 gap-2"},vt={class:"flex items-center space-x-2 w-full"},mt=["id","onUpdate:modelValue"],gt=["for"],ft={class:"w-full"},xt=["src","onClick"],bt={key:1,class:"h-16 flex items-center justify-center text-[10px] italic text-gray-400 border rounded"},ht={key:0,class:"mt-4"},wt={class:"border-l-2 border-red-400 pl-3 space-y-2"},yt={class:"text-sm font-semibold text-gray-900 dark:text-white"},kt={key:0,class:"text-xs text-gray-500 italic"},Ct={class:"text-xs text-gray-400"},_t={key:0,class:"fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white px-4 py-2 rounded shadow-lg z-50"},Et=["src"],R=10,St={__name:"MedicalApplications",setup(At){Ce.register(_e,Ee,Se,Ae,Fe,Me,je,Ue);const v=i(1),w=i("lastname"),m=i(""),p=i(!0),se=xe(),j=i(se.props.users||[]),d=i(null),ae=i(!0),oe=i(""),y=i(""),E=i({});i("");const k=i({visible:!1,message:""}),V=(s,e=3e3)=>{k.value.message=s,k.value.visible=!0,setTimeout(()=>{k.value.visible=!1},e)},le=s=>{const e=(s||"").toLowerCase();return e==="accepted"?"bg-green-100 text-green-700":e==="pending"?"bg-yellow-100 text-yellow-700":e==="rejected"?"bg-red-100 text-red-700":"bg-gray-100 text-gray-600"},S=async()=>{try{const s=await fetch("/medical-dashboard/applicants",{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!s.ok)throw new Error("Failed to fetch users");j.value=await s.json()}catch(s){oe.value=s.message}finally{ae.value=!1}};Z(()=>{S(),T()});const A=F(()=>{const s=y.value.trim().toLowerCase();return j.value.filter(e=>{var C;const n=`${e.firstname} ${e.lastname}`.toLowerCase().includes(s),h=m.value?((C=e.status)==null?void 0:C.toLowerCase())===m.value:!0;return n&&h}).sort((e,a)=>{const n=(e[w.value]||"").toString().toLowerCase(),h=(a[w.value]||"").toString().toLowerCase();return p.value?n.localeCompare(h):h.localeCompare(n)})});F(()=>y.value.trim()?A.value:j.value.slice(0,4));const B=async s=>{var e,a;try{const n=await axios.get(`/medical-dashboard/application/${s.id}`);d.value={...s,application:{...n.data.user.application,processes:((e=n.data.user.application)==null?void 0:e.processes)||[],program:((a=n.data.user.application)==null?void 0:a.program)||null},grades:n.data.user.grades||null},E.value=n.data.uploadedFiles||{},console.log("Full user data:",n.data.user),console.log("Grades check:",n.data.user.grades),await T(),console.log("User & files:",d.value,E.value)}catch(n){console.error("Failed to fetch user data:",n),E.value={},d.value=null}},re=()=>{d.value=null},ne=s=>({file10Front:"Grade 10 Front",file11:"Grade 11 Report",file12:"Grade 12 Report",schoolId:"School ID",nonEnrollCert:"Certificate of Non-Enrollment",psa:"PSA Birth Certificate",goodMoral:"Good Moral Certificate",underOath:"Under Oath Document",photo2x2:"2x2 Photo"})[s]||s,I=i(null),U=i(!1),ie=s=>{I.value=s,U.value=!0},z=()=>{U.value=!1},g=i(!1),x=i({}),b=i(""),de=()=>{g.value=!0,x.value=[],b.value=""},ue=()=>{g.value=!1,x.value=[],b.value=""},ce=async()=>{const s=Object.keys(x.value).filter(e=>x.value[e]);if(s.length===0||!b.value.trim()){alert("Please select files and enter a return note.");return}try{await axios.post(`/medical/return-files/${d.value.id}`,{files:s,note:b.value.trim()}),alert("Files returned and application status logged."),g.value=!1,x.value={},b.value="",await S(),await B(d.value)}catch(e){console.error(e),alert("Return failed.")}},G=s=>typeof s=="string"?s.charAt(0).toUpperCase()+s.slice(1):"",pe=s=>new Date(s).toLocaleString(),ve=async()=>{var s,e;try{await axios.post(`/medical-dashboard/accept/${d.value.id}`),V("Application cleared."),d.value=null,await S()}catch(a){console.error("Accept failed:",a);const n=((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"Failed to accept application due to an unexpected error.";V(n)}},me=i([]),T=async()=>{try{const s=await axios.get("/interviewer-dashboard/programs");me.value=s.data.programs}catch(s){console.error("Failed to load programs",s)}};Z(S);const q=F(()=>Math.ceil(A.value.length/R)),D=F(()=>{const s=(v.value-1)*R;return A.value.slice(s,s+R)});be([y,m,w,p],()=>{v.value=1});const ge=s=>{w.value===s?p.value=!p.value:(w.value=s,p.value=!0)},fe=()=>{y.value="",m.value="",w.value="lastname",p.value=!0,v.value=1,showStatusDropdown.value=!1};return(s,e)=>(l(),o(M,null,[_(N(he),{title:"All Medical Applications"}),_(ke,null,{default:$(()=>[t("div",Le,[t("div",Pe,[e[13]||(e[13]=t("h2",{class:"text-2xl font-bold text-[#9E122C]"}," All Applications ",-1)),t("div",Re,[t("div",Ve,[e[11]||(e[11]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-[#9E122C] mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),L(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>y.value=a),type:"text",placeholder:"Search by name...",class:"bg-transparent border-none outline-none focus:ring-0 focus:outline-none text-sm text-[#9E122C] placeholder-gray-500 w-full"},null,512),[[J,y.value]])]),t("button",{onClick:fe,class:"text-sm text-[#9E122C] border border-[#9E122C] rounded px-3 py-1.5 hover:bg-[#FDE8EA] transition"}," Clear Filters "),t("div",Be,[t("button",{onClick:e[1]||(e[1]=a=>s.showStatusDropdown=!s.showStatusDropdown),class:"text-[#9E122C] p-2 border border-[#9E122C] rounded-full",title:"Filter"},e[12]||(e[12]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2a1 1 0 01-.293.707L15 12.414V19a1 1 0 01-1.447.894l-4-2A1 1 0 019 17v-4.586L3.293 6.707A1 1 0 013 6V4z"})],-1)])),s.showStatusDropdown?(l(),o("div",Ie,[t("button",{class:"block px-4 py-2 w-full text-left hover:bg-gray-100",onClick:e[2]||(e[2]=a=>{m.value="",s.showStatusDropdown=!1})}," All "),t("button",{class:"block px-4 py-2 w-full text-left hover:bg-gray-100",onClick:e[3]||(e[3]=a=>{m.value="accepted",s.showStatusDropdown=!1})}," Accepted "),t("button",{class:"block px-4 py-2 w-full text-left hover:bg-gray-100",onClick:e[4]||(e[4]=a=>{m.value="pending",s.showStatusDropdown=!1})}," Pending "),t("button",{class:"block px-4 py-2 w-full text-left hover:bg-gray-100",onClick:e[5]||(e[5]=a=>{m.value="rejected",s.showStatusDropdown=!1})}," Rejected ")])):c("",!0)]),t("button",{onClick:e[6]||(e[6]=a=>p.value=!p.value),class:"text-[#9E122C] p-2 border border-[#9E122C] rounded-full",title:"Sort"},[(l(),o("svg",ze,[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:p.value?"M5 15l7-7 7 7":"M19 9l-7 7-7-7"},null,8,Ge)]))])])]),t("div",Te,[t("div",qe," Showing "+r(D.value.length)+" of "+r(A.value.length)+" users ",1),t("table",Oe,[t("thead",null,[t("tr",He,[t("th",{class:"pb-2 cursor-pointer",onClick:e[7]||(e[7]=a=>ge("lastname"))}," Name "),e[14]||(e[14]=t("th",{class:"pb-2"},"Course",-1)),e[15]||(e[15]=t("th",{class:"pb-2"},"Status",-1))])]),t("tbody",Ke,[(l(!0),o(M,null,P(D.value,a=>(l(),o("tr",{key:a.id,onClick:n=>B(a),class:"cursor-pointer hover:bg-white/10 backdrop-blur-sm transition"},[t("td",Xe,r(a.firstname)+" "+r(a.lastname),1),t("td",We,r(a.program.name||"—"),1),t("td",Ze,[t("span",{class:Y([le(a.status),"px-2 py-1 rounded text-sm font-semibold"])},r(a.status||"Unknown"),3)])],8,Qe))),128))])]),t("div",Je,[t("button",{onClick:e[8]||(e[8]=a=>v.value--),disabled:v.value===1,class:"text-sm text-[#9E122C] disabled:text-gray-900"}," Previous ",8,Ye),t("span",et,"Page "+r(v.value)+" of "+r(q.value),1),t("button",{onClick:e[9]||(e[9]=a=>v.value++),disabled:v.value===q.value,class:"text-sm text-[#9E122C] disabled:text-gray-900"}," Next ",8,tt)]),D.value.length===0?(l(),o("p",st," No results found. ")):c("",!0)])]),_(ee,{name:"slide-fade"},{default:$(()=>{var a,n,h,C,O,H,K,Q,X;return[d.value?(l(),o("div",at,[t("button",{class:"mt-6 px-4 py-2 rounded bg-[#9E122C] text-white hover:bg-[#EE6A43] transition",onClick:re}," Close "),e[22]||(e[22]=t("h3",{class:"text-xl font-semibold text-gray-900 dark:text-white mb-2"}," User Information ",-1)),t("p",ot," Name: "+r(d.value.lastname)+", "+r(d.value.firstname),1),t("p",lt," Email: "+r(d.value.email),1),t("div",rt,[e[16]||(e[16]=t("h4",{class:"text-sm font-bold text-gray-700 dark:text-white mb-1"}," Current Program: ",-1)),t("p",nt,r((h=(n=(a=d.value)==null?void 0:a.application)==null?void 0:n.program)==null?void 0:h.code)+" - "+r((H=(O=(C=d.value)==null?void 0:C.application)==null?void 0:O.program)==null?void 0:H.name),1)]),t("div",it,[g.value?c("",!0):(l(),o("button",{key:0,onClick:de,class:"px-3 py-1 text-gray-600 text-l rounded hover:text-yellow-700"},[_(N(De),{icon:N(Ne)},null,8,["icon"]),e[17]||(e[17]=te(" Actions "))])),g.value?(l(),o("button",{key:1,onClick:ue,class:"px-3 py-1 bg-gray-400 text-black text-sm rounded hover:bg-gray-500"}," Cancel ")):c("",!0)]),g.value?(l(),o("div",dt,[e[18]||(e[18]=t("label",{for:"returnNote",class:"block text-xs font-semibold mb-1"}," Return Reason / Note ",-1)),L(t("textarea",{id:"returnNote","onUpdate:modelValue":e[10]||(e[10]=u=>b.value=u),rows:"2",class:"w-full border rounded p-1 text-xs",placeholder:"Reason for returning..."},null,512),[[J,b.value]])])):c("",!0),g.value?(l(),o("div",ut,[t("button",{onClick:ce,class:"px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700"}," Return Selected Files "),t("button",{onClick:ve,class:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700"}," Clear Medical ")])):c("",!0),t("section",ct,[e[21]||(e[21]=t("h4",{class:"font-semibold mb-1 text-base"}," Uploaded Documents ",-1)),t("div",pt,[(l(!0),o(M,null,P(E.value,(u,f)=>(l(),o("div",{key:f,class:"flex flex-col items-start space-y-1"},[t("div",vt,[g.value?L((l(),o("input",{key:0,type:"checkbox",id:f,"onUpdate:modelValue":W=>x.value[f]=W,class:"h-4 w-4 mt-1"},null,8,mt)),[[we,x.value[f]]]):c("",!0),t("label",{for:f,class:"text-xs font-medium truncate w-full"},r(ne(f)),9,gt)]),t("div",ft,[u?(l(),o("img",{key:0,src:u,alt:"Uploaded Document",class:"h-16 w-full object-contain border rounded cursor-pointer",onClick:W=>ie(u)},null,8,xt)):(l(),o("div",bt," No Image "))])]))),128))]),(X=(Q=(K=d.value)==null?void 0:K.application)==null?void 0:Q.processes)!=null&&X.length?(l(),o("section",ht,[e[20]||(e[20]=t("h4",{class:"font-semibold mb-2 text-base text-gray-800 dark:text-gray-200"}," Application History ",-1)),t("ul",wt,[(l(!0),o(M,null,P(d.value.application.processes,(u,f)=>(l(),o("li",{key:f,class:"relative"},[e[19]||(e[19]=t("div",{class:"absolute -left-[10px] top-1 w-3 h-3 bg-red-600 rounded-full border-2 border-white"},null,-1)),t("p",yt,[te(r(G(u.stage))+" - ",1),t("span",{class:Y({"text-green-600":u.status==="completed","text-yellow-600":u.status==="in_progress","text-red-600":u.status==="returned"})},r(G(u.status)),3)]),u.notes?(l(),o("p",kt," Note: "+r(u.notes)+" By: "+r(u.performed_by.firstname)+" "+r(u.performed_by.lastname),1)):c("",!0),t("p",Ct,r(pe(u.created_at)),1)]))),128))])])):c("",!0)])])):c("",!0)]}),_:1}),_(ee,{name:"fade"},{default:$(()=>[k.value.visible?(l(),o("div",_t,r(k.value.message),1)):c("",!0)]),_:1}),U.value?(l(),o("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50",onClick:ye(z,["self"])},[t("img",{src:I.value,alt:"Preview",class:"max-w-full max-h-full rounded shadow-lg"},null,8,Et),t("button",{onClick:z,class:"absolute top-5 right-5 text-white text-4xl font-bold hover:text-gray-300","aria-label":"Close preview"}," × ")])):c("",!0)]),_:1})],64))}},Lt=$e(St,[["__scopeId","data-v-a79f651a"]]);export{Lt as default};
