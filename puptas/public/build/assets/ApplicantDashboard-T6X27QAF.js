import{r as n,i as P,p as R,c as K,o as l,w as S,a as e,d as r,e as g,b as O,n as w,t as o,F as j,g as F,f as Z,l as q}from"./app-B9ioD5Tj.js";import{_ as G}from"./ApplicantLayout-DyvDDIn8.js";import H from"./ApplicationReviewModal-FomoEm_S.js";import"./Sidebar-Dz9939gr.js";import"./index-BP1wD6F3.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useGlobalLoading-D_ggrvgV.js";const J={class:"py-12 overflow-y-auto scrollbar-hide"},Q={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-8"},W={class:"bg-white/30 dark:bg-gray-800 shadow-lg rounded-xl p-6 flex flex-col sm:flex-row sm:justify-between items-start sm:items-center gap-4"},X={key:0,class:"flex items-center gap-2"},Y={key:0,class:"bg-white/20 dark:bg-gray-900 shadow-lg rounded-xl p-6"},ee={class:"relative"},te={class:"space-y-12"},se={class:"flex flex-col items-center"},ae={class:"flex-1"},le={class:"text-sm font-semibold text-gray-800 dark:text-gray-200"},re={class:"text-xs text-gray-500 dark:text-gray-400 mt-0.5"},oe={class:"text-xs text-gray-500 dark:text-gray-400 mt-0.5 italic"},ne={class:"text-xs text-gray-400 dark:text-gray-500 mt-0.5"},ie={key:0},de={key:1},ce={key:1,class:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6"},ue={class:"text-xs text-center text-gray-700 dark:text-gray-300 font-medium"},pe={class:"mt-1"},ge=["src","onClick"],me=["onClick"],xe=["onChange"],fe={key:2,class:"text-center py-6 text-gray-600 dark:text-gray-300 animate-pulse"},ve={key:3,class:"text-center py-6 text-gray-500 dark:text-gray-400"},ye={key:4,class:"text-center text-red-500"},he=["src"],Me={__name:"ApplicantDashboard",props:{user:Object},setup($){const k=window.axios,B=$,f=n(!1),c=n(!1),m=n(""),d=n({}),x=n(""),v=n([]),C=n({}),y=n(!1),h=n(""),b=P(()=>Object.keys(d.value)),N=t=>t.replace(/([A-Z])/g," $1").toUpperCase(),I=t=>t.charAt(0).toUpperCase()+t.slice(1).replace("_"," "),T=t=>t.charAt(0).toUpperCase()+t.slice(1),L=t=>t?new Date(t).toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",_=t=>{switch((t||"").toLowerCase()){case"draft":return"bg-gray-400 border-gray-400";case"submitted":return"bg-blue-500 border-blue-500";case"in_progress":return"bg-yellow-500 border-yellow-500";case"completed":return"bg-green-500 border-green-500";case"returned":return"bg-red-500 border-red-500";default:return"bg-gray-500 border-gray-500"}},A=async()=>{c.value=!0,m.value="";try{const{data:t}=await k.get("/user/application");d.value=t.uploadedFiles||{},x.value=t.status||"",v.value=t.processes||[]}catch{m.value="Could not load application data."}finally{c.value=!1}},U=t=>{var s;return(s=C.value[t])==null?void 0:s.click()},V=async(t,s)=>{const a=t.target.files[0];if(!a)return;c.value=!0;const i=new FormData;i.append("file",a),i.append("field",s);try{const{data:u}=await k.post("/user/application/reupload",i);d.value[s]={url:u.url,status:u.status}}catch{alert("Failed to reupload file.")}finally{c.value=!1}},z=t=>{t&&(h.value=t,y.value=!0)},D=()=>{y.value=!1,h.value=""},E=()=>f.value=!1;return R(()=>{A(),f.value=!0}),(t,s)=>(l(),K(G,{title:"Applicant Dashboard"},{header:S(()=>s[0]||(s[0]=[e("h2",{class:"font-bold text-2xl text-gray-900 dark:text-gray-100"}," Applicant Dashboard ",-1)])),default:S(()=>[e("div",J,[e("div",Q,[e("div",W,[s[2]||(s[2]=e("div",null,[e("h3",{class:"text-xl font-semibold text-gray-900 dark:text-white"}," Application Tracker "),e("p",{class:"text-gray-600 dark:text-gray-300 mt-1"}," Track your progress and uploaded documents. ")],-1)),x.value?(l(),r("div",X,[s[1]||(s[1]=e("span",{class:"font-medium text-gray-700 dark:text-gray-300"},"Status:",-1)),e("span",{class:w(`px-4 py-1 rounded-full text-white font-semibold ${_(x.value)}`)},o(T(x.value)),3)])):g("",!0)]),v.value.length?(l(),r("div",Y,[s[6]||(s[6]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"}," Application Timeline ",-1)),e("div",ee,[s[5]||(s[5]=e("div",{class:"absolute top-6 left-1/2 transform -translate-x-1/2 w-1 h-full bg-gray-300 dark:bg-gray-600"},null,-1)),e("div",te,[(l(!0),r(j,null,F(v.value,(a,i)=>(l(),r("div",{key:i,class:"flex items-start space-x-6 relative"},[e("div",se,[e("div",{class:w(`w-8 h-8 rounded-full border-2 flex items-center justify-center text-white text-sm ${_(a.status)}`)},o(i+1),3),s[3]||(s[3]=e("div",{class:"mt-1 w-px h-full bg-gray-300 dark:bg-gray-600"},null,-1))]),e("div",ae,[e("h4",le,o(I(a.stage)),1),e("p",re,o(L(a.created_at)),1),e("p",oe,o(a.notes||"No notes"),1),e("p",ne,[s[4]||(s[4]=Z(" By: ")),a.performed_by?(l(),r("span",ie,o(a.performed_by.firstname)+" "+o(a.performed_by.lastname),1)):(l(),r("span",de,"System"))])])]))),128))])])])):g("",!0),b.value.length?(l(),r("div",ce,[(l(!0),r(j,null,F(b.value,(a,i)=>{var u,M;return l(),r("div",{key:a,class:"bg-white/30 dark:bg-gray-800 shadow-md rounded-xl p-4 flex flex-col items-center space-y-2 hover:scale-105 transition-transform"},[e("div",{class:w(`w-10 h-10 rounded-full flex items-center justify-center text-white text-sm ${_((u=d.value[a])==null?void 0:u.status)}`)},o(i+1),3),e("p",ue,o(N(a)),1),e("div",pe,[(M=d.value[a])!=null&&M.url?(l(),r("img",{key:0,src:d.value[a].url,alt:"Preview",class:"w-16 h-16 object-cover rounded-lg border cursor-pointer shadow-sm hover:shadow-lg transition-shadow",onClick:p=>z(d.value[a].url)},null,8,ge)):(l(),r("button",{key:1,onClick:p=>U(a),class:"text-blue-600 dark:text-blue-400 text-xs hover:underline"}," Upload ",8,me)),e("input",{type:"file",ref_for:!0,ref:p=>C.value[a]=p,class:"hidden",onChange:p=>V(p,a)},null,40,xe)])])}),128))])):g("",!0),c.value?(l(),r("div",fe," Loading… ")):b.value.length?m.value?(l(),r("div",ye,o(m.value),1)):g("",!0):(l(),r("div",ve," No files to display. ")),O(H,{show:f.value,userEmail:B.user.email,onClose:E,onRefreshDashboard:A},null,8,["show","userEmail"])])]),y.value?(l(),r("div",{key:0,class:"fixed inset-0 z-50 bg-black bg-opacity-80 flex items-center justify-center",onClick:D},[e("img",{src:h.value,alt:"Preview",class:"max-w-[90vw] max-h-[90vh] rounded shadow-lg"},null,8,he),e("button",{class:"absolute top-5 right-5 text-white text-3xl font-bold","aria-label":"Close preview",onClick:q(D,["stop"])}," × ")])):g("",!0)]),_:1}))}};export{Me as default};
