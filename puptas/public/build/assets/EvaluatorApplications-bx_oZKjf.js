import{r as n,Q as re,p as z,i as E,j as ne,d as o,o as l,b as D,u as ie,Z as ue,w as G,a as t,e as c,h as N,v as q,t as u,F as S,g as P,n as T,q as de,s as ce,f as pe,l as ve}from"./app-CbT4YxG1.js";import{_ as me}from"./EvaluatorLayout-BmshMQCk.js";import{C as fe,L as ge,a as xe,b as he,c as be,P as we,p as ye,d as ke,e as Ce}from"./chart-B9tDx7Vv.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Sidebar-ynefkf4f.js";import"./index-D26V7tGX.js";import"./useGlobalLoading-haryylb7.js";const Ee={class:"max-w-7xl mx-auto py-2 px-2 sm:px-4 md:px-6 lg:px-8 overflow-x-hidden overflow-y-auto"},Se={class:"flex flex-col md:flex-row justify-between md:items-center mb-2 gap-2"},Ae={class:"flex flex-wrap justify-end gap-2 items-center w-full md:w-auto"},Fe={class:"flex items-center border-4 border-red-400 rounded-full px-2 py-1.5 bg-white w-full sm:w-auto"},je={class:"relative"},Ue={key:0,class:"absolute top-full mt-2 right-0 bg-white shadow-md border border-gray-200 rounded z-50 text-sm"},De={xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Ne=["d"],Pe={class:"bg-white/20 rounded-xl shadow p-2 overflow-x-auto"},$e={class:"text-sm text-[#4B5563] mb-2"},Le={class:"min-w-full text-base"},Me={class:"text-left text-white font-semibold"},Re={class:"divide-y divide-gray-600"},Ve=["onClick"],Ie={class:"py-2 text-[#111827] font-medium"},Be={class:"py-2 text-white"},ze={class:"py-2"},Ge={class:"flex justify-end items-center space-x-4 mt-4"},qe=["disabled"],Te={class:"text-sm"},Oe=["disabled"],He={key:0,class:"text-center text-gray-400 mt-4"},Ke={key:0,class:"fixed top-0 right-0 w-full md:w-1/3 h-full bg-white dark:bg-gray-900 p-6 z-50 shadow-xl shadow-red-200 transition duration-300 ease-in-out overflow-y-auto"},Qe={class:"mt-3 flex space-x-2 justify-end"},Xe={key:0,class:"mt-2"},We={key:1,class:"mt-2 flex justify-end"},Ze={class:"text-gray-800 dark:text-gray-200 font-medium"},Je={class:"text-gray-700 dark:text-gray-400"},Ye={class:"mt-3 text-sm"},et={class:"grid grid-cols-3 gap-2"},tt={class:"flex items-center space-x-2 w-full"},st=["id","onUpdate:modelValue"],at=["for"],ot={class:"w-full"},lt=["src","onClick"],rt={key:1,class:"h-16 flex items-center justify-center text-[10px] italic text-gray-400 border rounded"},nt={key:0,class:"mt-4"},it={class:"border-l-2 border-red-400 pl-3 space-y-2"},ut={class:"text-sm font-semibold text-gray-900 dark:text-white"},dt={key:0,class:"text-xs text-gray-500 italic"},ct={class:"text-xs text-gray-400"},pt=["src"],$=10,vt={__name:"EvaluatorApplications",setup(mt){fe.register(ge,xe,he,be,we,ye,ke,Ce);const f=n(1),w=n("lastname"),g=n(""),v=n(!0),O=re(),A=n(O.props.users||[]),d=n(null),H=n(!0),K=n(""),y=n(""),k=n({});n(""),n({visible:!1,message:""});const Q=s=>{const e=(s||"").toLowerCase();return e==="accepted"?"bg-green-100 text-green-700":e==="pending"?"bg-yellow-100 text-yellow-700":e==="rejected"?"bg-red-100 text-red-700":"bg-gray-100 text-gray-600"},C=async()=>{try{const s=await fetch("/evaluator-dashboard/applicants",{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!s.ok)throw new Error("Failed to fetch users");A.value=await s.json()}catch(s){K.value=s.message}finally{H.value=!1}};z(()=>{C(),V()});const _=E(()=>{const s=y.value.trim().toLowerCase();return A.value.filter(e=>{var i;const r=`${e.firstname} ${e.lastname}`.toLowerCase().includes(s),b=g.value?((i=e.status)==null?void 0:i.toLowerCase())===g.value:!0;return r&&b}).sort((e,a)=>{const r=(e[w.value]||"").toString().toLowerCase(),b=(a[w.value]||"").toString().toLowerCase();return v.value?r.localeCompare(b):b.localeCompare(r)})});E(()=>y.value.trim()?_.value:A.value.slice(0,4));const F=async s=>{var e,a;try{const r=await axios.get(`/dashboard/user-files/${s.id}`);d.value={...s,application:{...r.data.user.application,processes:((e=r.data.user.application)==null?void 0:e.processes)||[],program:((a=r.data.user.application)==null?void 0:a.program)||null},grades:r.data.user.grades||null},k.value=r.data.uploadedFiles||{},console.log("Full user data:",r.data.user),console.log("Grades check:",r.data.user.grades),await V(),console.log("User & files:",d.value,k.value)}catch(r){console.error("Failed to fetch user data:",r),k.value={},d.value=null}},X=()=>{d.value=null},W=s=>({file10Front:"Grade 10 Front",file11:"Grade 11 Report",file12:"Grade 12 Report",schoolId:"School ID",nonEnrollCert:"Certificate of Non-Enrollment",psa:"PSA Birth Certificate",goodMoral:"Good Moral Certificate",underOath:"Under Oath Document",photo2x2:"2x2 Photo"})[s]||s,L=n(null),j=n(!1),Z=s=>{L.value=s,j.value=!0},M=()=>{j.value=!1},p=n(!1),x=n({}),m=n(""),J=()=>{p.value=!0,x.value=[],m.value=""},Y=()=>{p.value=!1,x.value=[],m.value=""},ee=async()=>{const s=Object.keys(x.value).filter(e=>x.value[e]);if(s.length===0||!m.value.trim()){alert("Please select files and enter a return note.");return}try{await axios.post(`/dashboard/return-files/${d.value.id}`,{files:s,note:m.value.trim()}),alert("Files returned and application status logged."),p.value=!1,x.value={},m.value="",await C(),await F(d.value)}catch(e){console.error(e),alert("Return failed.")}},R=s=>typeof s=="string"?s.charAt(0).toUpperCase()+s.slice(1):"",te=s=>new Date(s).toLocaleString(),se=async()=>{try{await axios.post(`/evaluator/pass-application/${d.value.id}`,{note:m.value||""}),alert("Application successfully passed to the next step."),p.value=!1,x.value={},m.value="",await C(),await F(d.value)}catch(s){console.error("Error passing application:",s),alert("Failed to pass application.")}},ae=n([]),V=async()=>{try{const s=await axios.get("/interviewer-dashboard/programs");ae.value=s.data.programs}catch(s){console.error("Failed to load programs",s)}};z(C);const I=E(()=>Math.ceil(_.value.length/$)),U=E(()=>{const s=(f.value-1)*$;return _.value.slice(s,s+$)});ne([y,g,w,v],()=>{f.value=1});const oe=s=>{w.value===s?v.value=!v.value:(w.value=s,v.value=!0)},le=()=>{y.value="",g.value="",w.value="lastname",v.value=!0,f.value=1,showStatusDropdown.value=!1};return(s,e)=>(l(),o(S,null,[D(ie(ue),{title:"All Interviewer Applications"}),D(me,null,{default:G(()=>[t("div",Ee,[t("div",Se,[e[13]||(e[13]=t("h2",{class:"text-2xl font-bold text-[#9E122C]"}," All Applications ",-1)),t("div",Ae,[t("div",Fe,[e[11]||(e[11]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-[#9E122C] mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),N(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>y.value=a),type:"text",placeholder:"Search by name...",class:"bg-transparent border-none outline-none focus:ring-0 focus:outline-none text-sm text-[#9E122C] placeholder-gray-500 w-full"},null,512),[[q,y.value]])]),t("button",{onClick:le,class:"text-sm text-[#9E122C] border border-[#9E122C] rounded px-3 py-1.5 hover:bg-[#FDE8EA] transition"}," Clear Filters "),t("div",je,[t("button",{onClick:e[1]||(e[1]=a=>s.showStatusDropdown=!s.showStatusDropdown),class:"text-[#9E122C] p-2 border border-[#9E122C] rounded-full",title:"Filter"},e[12]||(e[12]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2a1 1 0 01-.293.707L15 12.414V19a1 1 0 01-1.447.894l-4-2A1 1 0 019 17v-4.586L3.293 6.707A1 1 0 013 6V4z"})],-1)])),s.showStatusDropdown?(l(),o("div",Ue,[t("button",{class:"block px-4 py-2 w-full text-left hover:bg-gray-100",onClick:e[2]||(e[2]=a=>{g.value="",s.showStatusDropdown=!1})}," All "),t("button",{class:"block px-4 py-2 w-full text-left hover:bg-gray-100",onClick:e[3]||(e[3]=a=>{g.value="accepted",s.showStatusDropdown=!1})}," Accepted "),t("button",{class:"block px-4 py-2 w-full text-left hover:bg-gray-100",onClick:e[4]||(e[4]=a=>{g.value="pending",s.showStatusDropdown=!1})}," Pending "),t("button",{class:"block px-4 py-2 w-full text-left hover:bg-gray-100",onClick:e[5]||(e[5]=a=>{g.value="rejected",s.showStatusDropdown=!1})}," Rejected ")])):c("",!0)]),t("button",{onClick:e[6]||(e[6]=a=>v.value=!v.value),class:"text-[#9E122C] p-2 border border-[#9E122C] rounded-full",title:"Sort"},[(l(),o("svg",De,[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:v.value?"M5 15l7-7 7 7":"M19 9l-7 7-7-7"},null,8,Ne)]))])])]),t("div",Pe,[t("div",$e," Showing "+u(U.value.length)+" of "+u(_.value.length)+" users ",1),t("table",Le,[t("thead",null,[t("tr",Me,[t("th",{class:"pb-2 cursor-pointer",onClick:e[7]||(e[7]=a=>oe("lastname"))}," Name "),e[14]||(e[14]=t("th",{class:"pb-2"},"Course",-1)),e[15]||(e[15]=t("th",{class:"pb-2"},"Status",-1))])]),t("tbody",Re,[(l(!0),o(S,null,P(U.value,a=>(l(),o("tr",{key:a.id,onClick:r=>F(a),class:"cursor-pointer hover:bg-white/10 backdrop-blur-sm transition"},[t("td",Ie,u(a.firstname)+" "+u(a.lastname),1),t("td",Be,u(a.program.name||"—"),1),t("td",ze,[t("span",{class:T([Q(a.status),"px-2 py-1 rounded text-sm font-semibold"])},u(a.status||"Unknown"),3)])],8,Ve))),128))])]),t("div",Ge,[t("button",{onClick:e[8]||(e[8]=a=>f.value--),disabled:f.value===1,class:"text-sm text-[#9E122C] disabled:text-gray-900"}," Previous ",8,qe),t("span",Te,"Page "+u(f.value)+" of "+u(I.value),1),t("button",{onClick:e[9]||(e[9]=a=>f.value++),disabled:f.value===I.value,class:"text-sm text-[#9E122C] disabled:text-gray-900"}," Next ",8,Oe)]),U.value.length===0?(l(),o("p",He," No results found. ")):c("",!0)])]),D(de,{name:"slide-fade"},{default:G(()=>{var a,r,b;return[d.value?(l(),o("div",Ke,[t("button",{class:"mt-6 px-4 py-2 rounded bg-[#9E122C] text-white hover:bg-[#EE6A43] transition",onClick:X}," Close "),t("div",Qe,[p.value?c("",!0):(l(),o("button",{key:0,onClick:J,class:"px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700"}," Evaluate ")),p.value?(l(),o("button",{key:1,onClick:Y,class:"px-3 py-1 bg-gray-400 text-black text-sm rounded hover:bg-gray-500"}," Cancel ")):c("",!0)]),p.value?(l(),o("div",Xe,[e[16]||(e[16]=t("label",{for:"returnNote",class:"block text-xs font-semibold mb-1"}," Return Reason / Note ",-1)),N(t("textarea",{id:"returnNote","onUpdate:modelValue":e[10]||(e[10]=i=>m.value=i),rows:"2",class:"w-full border rounded p-1 text-xs",placeholder:"Reason for returning..."},null,512),[[q,m.value]])])):c("",!0),p.value?(l(),o("div",We,[t("button",{onClick:ee,class:"px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700"}," Return Selected Files "),p.value&&d.value?(l(),o("button",{key:0,class:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",onClick:se}," Pass Application ")):c("",!0)])):c("",!0),e[20]||(e[20]=t("h3",{class:"text-xl font-semibold text-gray-900 dark:text-white mb-2"}," User Information ",-1)),t("p",Ze," Name: "+u(d.value.lastname)+", "+u(d.value.firstname),1),t("p",Je," Email: "+u(d.value.email),1),t("section",Ye,[e[19]||(e[19]=t("h4",{class:"font-semibold mb-1 text-base"}," Uploaded Documents ",-1)),t("div",et,[(l(!0),o(S,null,P(k.value,(i,h)=>(l(),o("div",{key:h,class:"flex flex-col items-start space-y-1"},[t("div",tt,[p.value?N((l(),o("input",{key:0,type:"checkbox",id:h,"onUpdate:modelValue":B=>x.value[h]=B,class:"h-4 w-4 mt-1"},null,8,st)),[[ce,x.value[h]]]):c("",!0),t("label",{for:h,class:"text-xs font-medium truncate w-full"},u(W(h)),9,at)]),t("div",ot,[i?(l(),o("img",{key:0,src:i,alt:"Uploaded Document",class:"h-16 w-full object-contain border rounded cursor-pointer",onClick:B=>Z(i)},null,8,lt)):(l(),o("div",rt," No Image "))])]))),128))]),(b=(r=(a=d.value)==null?void 0:a.application)==null?void 0:r.processes)!=null&&b.length?(l(),o("section",nt,[e[18]||(e[18]=t("h4",{class:"font-semibold mb-2 text-base text-gray-800 dark:text-gray-200"}," Application History ",-1)),t("ul",it,[(l(!0),o(S,null,P(d.value.application.processes,(i,h)=>(l(),o("li",{key:h,class:"relative"},[e[17]||(e[17]=t("div",{class:"absolute -left-[10px] top-1 w-3 h-3 bg-red-600 rounded-full border-2 border-white"},null,-1)),t("p",ut,[pe(u(R(i.stage))+" - ",1),t("span",{class:T({"text-green-600":i.status==="completed","text-yellow-600":i.status==="in_progress","text-red-600":i.status==="returned"})},u(R(i.status)),3)]),i.notes?(l(),o("p",dt," Note: "+u(i.notes),1)):c("",!0),t("p",ct,u(te(i.created_at)),1)]))),128))])])):c("",!0)])])):c("",!0)]}),_:1}),j.value?(l(),o("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50",onClick:ve(M,["self"])},[t("img",{src:L.value,alt:"Preview",class:"max-w-full max-h-full rounded shadow-lg"},null,8,pt),t("button",{onClick:M,class:"absolute top-5 right-5 text-white text-4xl font-bold hover:text-gray-300","aria-label":"Close preview"}," × ")])):c("",!0)]),_:1})],64))}},kt=_e(vt,[["__scopeId","data-v-971832e8"]]);export{kt as default};
